<!DOCTYPE html>
<html>


<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">


	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>
	<body>
	
	
	
	
			<div class="container">
			
			<h3> <span class="badge badge-secondary"></span></h3>

			<button type="button" class="btn btn-primary" onclick="launchUrl()">Launch</button>
				<button type="button" class="btn btn-primary" onclick="parse()">Parse</button>
		
				<h3> <span class="badge badge-secondary"></span></h3>
		
				<div class="card">
					<div id="access_token" class="card-body">
					</div>
				</div>
		
				<h3> <span class="badge badge-secondary"></span></h3>

			
			<div class="modal" id="modalWindowUpdate" tabindex="-1" role="dialog">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Update User Information</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div id="modalBody" class="modal-body">
							<div class="input-group flex-nowrap">
								<div class="input-group-prepend">
									<span class="input-group-text" id="addon-wrapping">First Name</span>
								</div>
								<input type="text" id="firstName" class="form-control" placeholder="Username" aria-label="Username" aria-describedby="addon-wrapping">
							</div>
							<div class="input-group flex-nowrap">
								<div class="input-group-prepend">
									<span class="input-group-text" id="addon-wrapping">Last Name</span>
								</div>
								<input type="text" id="lastName" class="form-control" placeholder="Username" aria-label="Username" aria-describedby="addon-wrapping">
							</div>
							<div class="input-group flex-nowrap">
								<div class="input-group-prepend">
									<span class="input-group-text" id="addon-wrapping">Phone</span>
								</div>
								<input type="text" id="mobilePhone" class="form-control" placeholder="Username" aria-label="Username" aria-describedby="addon-wrapping">
							</div>
							<div class="input-group flex-nowrap">
								<div class="input-group-prepend">
									<span class="input-group-text" id="addon-wrapping">Email</span>
								</div>
								<input type="text" id="email" class="form-control" placeholder="Username" aria-label="Username" aria-describedby="addon-wrapping">
							</div>

						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
							<button type="button" class="btn btn-primary" onclick="postUserApiCall()">Save changes</button>
						</div>
					</div>
				</div>
			</div>
		
		</div>	
		
		<div class="modal" id="modalWindowAdmin" tabindex="-1" role="dialog">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Modal title</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body">
					<div class="input-group flex-nowrap">
						<div class="input-group-prepend">
							<span class="input-group-text" id="addon-wrapping">User ID</span>
						</div>
						<input type="text" id="userIdAdmin" class="form-control" placeholder="Okta ID" aria-label="OktaId" aria-describedby="addon-wrapping">
					</div>
					
					<div class="input-group flex-nowrap">
						<div class="input-group-prepend">
							<span class="input-group-text" id="addon-wrapping">Admin Role</span>
						</div>
						<input type="text" id="desiredAdminRole" class="form-control" placeholder="Role" aria-label="Role" aria-describedby="addon-wrapping">
					</div>
					
					
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" onclick="postAdminApiCall()">Save changes</button>
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="container">

	<!-- LIST USERS ACTIONS -->
		<button type="button" class="btn btn-primary" onclick="getListUsersApiCall()">Get Users</button>
		<button type="button" class="btn btn-primary" onclick="getListUsersApiCallRefresh()">Refresh Users</button>
		
		<h3> <span class="badge badge-secondary"></span></h3>
		
		<div class="card">
			<div id="response" class="card-body">
			</div>
		</div>
		
		<h3> <span class="badge badge-secondary"></span></h3>


	</div>
	
	<div class="container">	
		
		<!-- GET USER, VIEW USER, UPDATE USER ACTIONS -->
		<button type="button" class="btn btn-primary" onclick="getUserApiCall()">Get User</button>
		<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalWindowUpdate">View User</button>
		<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalWindowCreate" onclick="postUserApiCall()">Update User</button>
	
		
		<h3> <span class="badge badge-secondary"></span></h3>
		
		<div class="card">
			<div id="response" class="card-body">
			</div>
		</div>
		
		<h3> <span class="badge badge-secondary"></span></h3>

		</div>
		
		<div class="container">
		<!-- PROMOTE USER TO ADMIN ACTION -->
			<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalWindowAdmin">Promote to Admin</button>
		
		<h3> <span class="badge badge-secondary"></span></h3>
		
		<div class="card">
			<div id="response" class="card-body">
			</div>
		</div>
		
		<h3> <span class="badge badge-secondary"></span></h3>
		
		</div>

		<div class="container">
		<!-- DELETE SPECIFIC USER ACTIONS -->
	    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalWindowDelete">[x] Delete User</button>
		
		<h3> <span class="badge badge-secondary"></span></h3>
		
		<div class="card">
			<div id="response" class="card-body">
			</div>
		</div>
		
		<h3> <span class="badge badge-secondary"></span></h3>


		</div>
	
	<script>
	
	function parse() {
				
				// query string: ?foo=lorem&bar=&baz
				var foo = getParameterByName('access_token'); // "lorem"
				console.log(foo)
				sessionStorage.setItem("access_token", foo)
				document.getElementById("access_token").innerHTML = foo

				function getParameterByName(name, url) {
					if (!url) url = window.location.href;
					name = name.replace(/[\[\]]/g, '\\$&');
					var regex = new RegExp('[#?&]' + name + '(=([^&#]*)|&|#|$)'),
						results = regex.exec(url);
					if (!results) return null;
					if (!results[2]) return '';
					return decodeURIComponent(results[2].replace(/\+/g, ' '));
				}

						
		}
		

	</script>
	
	<script>
	
	console.log(sessionStorage.getItem("access_token"))
		
function launchUrl(x, callback) {
	var state = uuidv4();
	var nonce = uuidv4();
	
	console.log(state)
	console.log(nonce)
	
	var config = {
			client_id: "0oa1vk06xoo6xSAE5357",
			redirect_uri: "https://adamacrown1.github.io/webapp/admin/",
			authorization_endpoint: "https://dev-602311.okta.com/oauth2/v1/authorize",
			token_endpoint: "https://dev-602311.okta.com/oauth2/v1/token",
			requested_scopes: "openid profile okta.users.read okta.users.manage okta.roles.manage okta.roles.read",
	
	};

	var url = config.authorization_endpoint 
				+ "?response_type=token"
				+ "&client_id="+encodeURIComponent(config.client_id)
				+ "&state="+encodeURIComponent(state)
				+ "&scope="+encodeURIComponent(config.requested_scopes)
				+ "&redirect_uri="+encodeURIComponent(config.redirect_uri)
				+ "&nonce="+"1234";
		// Redirect to the authorization server
		window.location = url;
		console.log(url);
		callback();
			
			function uuidv4() {
				return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
					var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
					 return v.toString(16);
					
				});
			}
		
		}
	
	</script>
	
		<script>
		
		
		//Params
		baseUrl = "https://cors-anywhere.herokuapp.com/https://dev-602311.okta.com"
		userId = "00u1th4505zNOOhC2357"
		//List Users APIs
		listUsers = baseUrl + "/api/v1/users/?limit=200"
		url1 = listUsers
		
		//Get User
		getUserApi = baseUrl + "/api/v1/users/" + userId
		
		//Post User Update
		postUserApi = baseUrl + "/api/v1/users/" + userId
		
		
		//GET Requests via Ajax
	
	function getListUsersApiCallRefresh() {
		
		access_token = sessionStorage.getItem("access_token")
		document.getElementById("response").innerHTML = ""
		console.log("GETAPISTART")
		getAPI(url1, access_token, parseData);
		
		}
		
		
		function getListUsersApiCall() {
			
			access_token = sessionStorage.getItem("access_token")
			console.log("GETAPISTART")
			getAPI(url1, access_token, parseData);
			
			}
		
		//Get User
		function getUserApiCall() {
				
				access_token = sessionStorage.getItem("access_token")
				console.log("GETAPISTART")
				getAPI(getUserApi, access_token, parseUserData);
				
		}
		
		//Post User
		function postUserApiCall() {
				
				console.log("GETAPISTART")
				
				
				access_token = sessionStorage.getItem("access_token")
				
				firstName = document.getElementById("firstName").value;
				lastName = document.getElementById("lastName").value;
				mobile = document.getElementById("mobilePhone").value;
				email = document.getElementById("email").value;
				console.log(firstName + lastName + mobile + email)
				
				console.log(postUserApi)
							
							
				postPayload = "{ " + '"profile"' + ': { "firstName": "' + firstName + '", "lastName": "' + lastName + '", "email": "' + email + '", "mobilePhone": "' + mobile + '" } }'
				console.log(postPayload)
						
						
					//	"mobilePhone": "123-456-7890"
					//}
			//	}"			
							
		
			postAPI(postUserApi, access_token, postPayload, parseUserData);
			
		
		
		}
		
		function postAdminApiCall() {
				
				console.log("GETAPISTART")
				
				userId = document.getElementById("userIdAdmin").value;
				desiredAdminRole = document.getElementById("desiredAdminRole").value;
				console.log(userId + desiredAdminRole)
				console.log('{ "type": "' + desiredAdminRole + '" }')
			
				postPayload = '{ "type": "' + desiredAdminRole + '" }'
				

				postUserApiRoles = baseUrl + "/api/v1/users/" + userId + "/roles"
				console.log(postUserApiRoles)

				postAPI(postUserApiRoles, postPayload, log);
			
		
		
		}
		
		
		
		function parseUserData(callback) {
				
				console.log("parseUserData")
				console.log(response)
				userId = response.id
				userLastName = response.profile.lastName
				userFirstName = response.profile.firstName
				userMobilePhone = response.profile.mobilePhone
				userEmail = response.profile.email
				
				console.log(userId)	
				console.log(userFirstName)
				console.log(userLastName)
				
				document.getElementById("firstName").value = userFirstName;
				document.getElementById("lastName").value = userLastName;
				document.getElementById("mobilePhone").value = userMobilePhone;
				document.getElementById("email").value = userEmail;
			
				}
	
	function parseData(callback) {
	
		var step;
		end = Object.keys(response).length
		console.log(end)
			
		for (step = 0; step < end ; step++) {
		
		userId = response[step].id
		userLastName = response[step].profile.lastName
		userFirstName = response[step].profile.firstName
		
		console.log(userId)	
		console.log(userFirstName)
		console.log(userLastName)
		
		document.getElementById("response").innerHTML += userId + " | " + userFirstName + " | " + userLastName + "<br>"
		}
		
		//}
	}
	

	function getAPI(url1, access_token, callback) {
	
		$.ajax({

			url : url1,
			type : 'GET',
			beforeSend: function(xhr) {
				xhr.setRequestHeader('Authorization', 'Bearer ' + access_token),
					xhr.setRequestHeader('Accept', 'application/json'),
					xhr.setRequestHeader('Content-Type', 'application/json');
			},

			success : function(data) {              
				//alert(JSON.stringify(data));
				response = data
				console.log("GETAPIMIDDLE1")
				console.log(response)
				callback();
			},
			error : function(request,error)
			{
				alert("Request: "+JSON.stringify(request));
			}
		});
		
}

function postAPI(url1, access_token, postPayload, callback) {
	
		$.ajax({

			url : url1,
			type : 'POST',
			data : postPayload,
			beforeSend: function(xhr) {
				xhr.setRequestHeader('Authorization', 'Bearer ' + access_token),
					xhr.setRequestHeader('Accept', 'application/json'),
					xhr.setRequestHeader('Content-Type', 'application/json');
			},

			success : function(data) {              
				//alert(JSON.stringify(data));
				response = data
				console.log("GETAPIMIDDLE1")
				console.log(response)
				callback();
			},
			error : function(request,error)
			{
				console.log("Request: "+JSON.stringify(request));
			}
		});
		
}
		
		</script>
		
	</body>
</html>
